# 哪吒形象生成系统

一个基于AI的图像生成系统，允许用户上传照片并生成不同风格的哪吒形象。

## 项目规划

### 第一阶段：核心功能实现
- [x] 基础架构搭建
- [x] 令牌系统实现
- [x] 图像生成服务集成
- [x] 基本用户界面实现

### 第二阶段：功能完善
- [x] 令牌使用限制实现
  - 每个令牌只能用于一张照片
  - 同一张照片可以使用不同风格（最多3种）
- [ ] 图片缓存系统
  - 用户上传图片缓存
  - 生成结果缓存
- [ ] 历史记录展示
  - 显示已生成的图片
  - 显示使用过的风格

### 第三阶段：管理功能
- [x] 令牌生成工具
  - 批量生成令牌
  - 生成二维码
  - 生成海报（可选）
- [x] 使用统计
  - 令牌使用次数统计
  - 风格使用统计
- [x] 系统改进
  - 动态加载tokens配置（实时检查新生成的tokens）
  - 从配置文件中读取二维码URL（不再硬编码）

### 第四阶段：优化与改进
- [ ] 性能优化
- [ ] 错误处理完善
- [ ] 日志系统完善

## 当前功能

### 用户功能
1. **令牌访问**
   - 通过二维码或链接访问系统
   - 令牌有效期管理
   - 使用次数限制

2. **图片生成**
   - 上传个人照片
   - 选择生成风格
   - 生成两张不同风格的图片
   - 查看生成历史

3. **风格管理**
   - 每个令牌最多使用3种风格
   - 风格使用记录
   - 可用风格提示

### 管理员功能
1. **令牌管理**
   ```bash
   python generate_tokens.py --count 5 --theme ice --prefix "ice_" --max-usage 10 --usage-days 2 --access-days 9
   ```
   - 批量生成令牌
   - 设置使用限制
   - 生成二维码
   - 生成海报（可选）

2. **使用统计**
   - 查看令牌使用情况
   - 监控风格使用情况

## 技术架构

### 核心模块
- `app_gate.py`: 主应用入口，处理用户界面和请求
- `Module/core/`: 核心功能模块
  - `auth_service.py`: 认证和令牌管理
  - `image_service.py`: 图像处理服务
  - `admin_service.py`: 管理员功能
  - `utils.py`: 工具函数

### 配置管理
- `config.json`: 主配置文件
- `Module/style/nezha/config.json`: 哪吒主题配置
- `Module/style/nezha/storage/tokens.json`: 令牌存储

## 使用说明

### 用户使用流程
1. 获取访问令牌（二维码或链接）
2. 上传个人照片
3. 选择生成风格（首次生成后显示）
4. 查看生成结果
5. 可以继续使用不同风格（最多3种）

### 管理员使用流程
1. 使用令牌生成工具创建新令牌
2. 设置令牌参数（主题、使用次数、有效期等）
3. 生成二维码和海报（可选）
4. 分发令牌给用户

## 注意事项
1. 每个令牌只能用于一张照片
2. 同一张照片可以使用不同风格（最多3种）
3. 一旦使用照片后不能更换
4. 请确保选择最喜欢的照片再开始生成

## 开发说明
- 使用Gradio构建用户界面
- 使用Python处理图像生成
- 使用JSON文件存储配置和令牌信息
- 支持冰主题和火主题两种风格

## 待优化项目
1. 用户界面交互体验
2. 图片生成性能
3. 错误处理机制
4. 日志记录系统
5. 数据备份机制
